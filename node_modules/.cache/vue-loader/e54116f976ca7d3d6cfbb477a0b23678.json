{"remainingRequest":"/Users/lirongzhi/Documents/深圳善链/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lirongzhi/Documents/深圳善链/src/view/plus/shopx/goodsDetail/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lirongzhi/Documents/深圳善链/src/view/plus/shopx/goodsDetail/index.vue","mtime":1572538946844},{"path":"/Users/lirongzhi/Documents/深圳善链/node_modules/cache-loader/dist/cjs.js","mtime":1572539003414},{"path":"/Users/lirongzhi/Documents/深圳善链/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {Toast, Popup} from 'vant';\nimport mixins from '../../../../common/mixin';\nimport navBar from '../../../../component/navBar';\n\nimport {swiper, swiperSlide} from 'vue-awesome-swiper';\nimport 'swiper/dist/css/swiper.css'\n\nexport default {\n    components: {\n        Toast,\n        navBar,\n        swiper,\n        swiperSlide,\n        Popup\n    },\n    mixins: [mixins],\n\n    data: () => ({\n        isLoadSuccess: false,               // 页面是否加载完成\n        showBottomPopup: false,             // 购买弹框\n        bannerHeight: 0,                    // banner高度\n        swiperOption: {                     // 轮播\n            autoplay: true,\n            speed: 1000,\n            pagination: {\n                el: '.swiper-pagination'\n            }\n        },\n        goods: {},                           // 商品信息\n        goodsNumber: 1,                      // 购买商品数量\n        stockNum: 0,                         // 库存\n        goodsPrice: 0,                       // 商品价格\n        goodsPriceDecimal: 0,                // 商品价格后面小数\n        goodsSpecArr: [],                    // 记录规格数组\n        skuIndex: '',                        // 选中的sku\n    }),\n    // 设置路由钩子，存储页面来源\n    beforeRouteEnter(to, from, next) {\n        next(vm => {          //  这里的vm指的就是vue实例，可以用来当做this使用\n            sessionStorage.setItem('url_from', from.path);\n        })\n    },\n    created() {\n\n    },\n    mounted() {\n        this.handleSetBannerHeight();\n        this.handleLoad();\n    },\n    methods: {\n        // 可视窗口高度\n        handleSetBannerHeight: function () {\n            this.bannerHeight = document.body.clientWidth;\n        },\n        // 修改商品数量\n        handleEditGoodsNumber: function (index) {\n            if (index == 0) {\n                if (this.goodsNumber > 1) {\n                    this.goodsNumber -= 1\n                } else {\n                    this.goodsNumber = 1;\n                }\n            } else {\n                this.goodsNumber += 1\n            }\n        },\n        // 页面加载\n        handleLoad() {\n            this.request({\n                url: 'api/store/goods',\n                method: 'POST',\n                data: {\n                    id: this.$route.query.id\n                },\n                success: (response) => {\n                    this.goods = response;\n                    console.log(this.goods.detail.min_price)\n                    // 初始化库存、商品显示价格\n                    if(this.goods.detail.min_price) {\n                        this.stockNum = this.goods.detail.sku[0].stock;\n                        this.goodsPriceDecimal = this.goods.detail.min_price.substring(this.goods.detail.min_price.length - 2);\n                        this.goodsPrice = this.goods.detail.min_price.substring(0, this.goods.detail.min_price.length - 2);\n                    }\n\n                    // 加载完成标识\n                    this.isLoadSuccess = true;\n\n                    // sku初始化\n                    if(this.goods.sku_data) {\n                        this.goods.sku_data.spec_attr.map((data) => {\n                            data.spec_items.map((children, index) => {\n                                if (index == 0) {\n                                    children.active = true;\n                                } else {\n                                    children.active = false;\n                                }\n                            })\n                        })\n                    }\n\n                    // 判断是否是多规格\n                    if(this.goods.detail.spec_type == 2) {\n                        this.skuIndex = this.goods.sku_data.sku_list[0].id;\n                        this.handleUpdateSpecGoods(this.goods.sku_data)\n                    }\n                },\n                error: (response) => {\n\n                },\n                complete: () => {\n\n                }\n            });\n        },\n        handleUpdateSpecGoods: function (data) {\n            for (let i in data.spec_attr) {\n                for (let j in data.spec_attr[i].spec_items) {\n                    if (j < 1) {\n                        // 记录规格数组\n                        this.goodsSpecArr[i] = data.spec_attr[i].spec_items[0].item_id;\n                    }\n                }\n            }\n            return data;\n        },\n        handleSkuItem: function (id, index) {\n            if(this.goods.detail.spec_type != 2) {\n                return\n            }\n            this.goods.sku_data.spec_attr[index].spec_items.map((children, index) => {\n                if (children.item_id === id) {\n                    children.active = true;\n                } else {\n                    children.active = false;\n                }\n            })\n\n            for (let i in this.goods.sku_data.spec_attr) {\n                for (let j in this.goods.sku_data.spec_attr[i].spec_items) {\n                    if (index == i) {\n                        if (index == j) {\n                            this.goods.sku_data.spec_attr[i].spec_items.map((data) => {\n                                if(data.active) {\n                                    this.goodsSpecArr[i] = data.item_id;\n                                }\n                            })\n                        }\n                    }\n                }\n            }\n            let spec_sku_id = this.goodsSpecArr.join('_');\n            let spec_list = this.goods.sku_data.sku_list,\n            skuItem = spec_list.find((val) => {\n                return val.sku_index == spec_sku_id;\n            });\n            // 选中的规格\n            // console.log(spec_list)\n\n            this.skuIndex = skuItem.id;\n            this.stockNum = skuItem.form.stock;\n            this.goodsPriceDecimal = skuItem.form.price.substring(skuItem.form.price.length - 2);\n            this.goodsPrice = skuItem.form.price.substring(0, skuItem.form.price.length - 2);\n\n            this.$set(this.goods.sku_data.spec_attr, index, this.goods.sku_data.spec_attr[index]);\n        },\n        // 数量必须大于0\n        handleSetGoodsNumber: function() {\n            if(this.goodsNumber < 1) {\n                this.goodsNumber = 1;\n            }\n        },\n        handleSubmit: function() {\n\n            let orderInfo = {\n                id: parseInt(this.$route.query.id),\n                sku_id: this.goods.detail.spec_type == 2 ? this.skuIndex : this.goods.detail.sku[0].id,\n                in_delivery_rule: true,\n                order_pay_price: this.goodsPrice + this.goodsPriceDecimal,\n                order_total_price: Number(this.goodsPrice + this.goodsPriceDecimal) * this.goodsNumber,\n                order_total_quantity: this.goodsNumber,\n                goods_list: [{\n                    image: this.goods.detail.image[0] ? this.goods.detail.image[0].file.path : '',\n                    name: this.goods.detail.name\n                }]\n            };\n\n            this.$router.push({\n                path: '/plus/shopx/order/order',\n                query: {\n                    order: JSON.stringify(orderInfo)\n                }\n            });\n\n\n        }\n    }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2FA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA","file":"index.vue","sourceRoot":"src/view/plus/shopx/goodsDetail","sourcesContent":["\n<template>\n    <div class=\"goods-main\" v-if=\"isLoadSuccess\">\n        <navBar title=\"商品详情\"></navBar>\n\n        <div class=\"banner\" :style=\"'height:' + bannerHeight + 'px'\">\n            <swiper :options=\"swiperOption\">\n                <swiper-slide v-for=\"(image, index) in goods.detail.image\"\n                              :key=\"index\" >\n                    <div class=\"banner-img\"\n                         :style=\"'height:' + bannerHeight + 'px;' +\n                                'background: url(' + image.file.path + ');' +\n                                'background-size: cover;' +\n                                'background-position: center;'\"></div>\n                </swiper-slide>\n                <div class=\"swiper-pagination\" slot=\"pagination\"></div>\n            </swiper>\n        </div>\n\n        <div class=\"content\">\n            <div class=\"content-title line-clamp-two\">{{goods.detail.name}}</div>\n            <div class=\"content-price\">\n                ¥{{goodsPrice}}<b style=\"font-size: 14px;\">{{goodsPriceDecimal}}</b>\n                <span class=\"market\">\n                   市场价\n                   <s v-if=\"goods.detail.sku[0]\">{{goods.detail.sku[0].line_price}}元</s>\n               </span>\n            </div>\n            <div class=\"content-ask\">\n                <strong v-for=\"item in goods.detail.available_pay_type\"\n                      :key=\"item\">\n                    <span v-if=\"item == 1\">ETH</span>\n                    <span v-if=\"item == 2\">INE</span>\n                    <span v-if=\"item == 3\">UTD</span>\n                </strong>\n            </div>\n        </div>\n\n        <div class=\"detail-by\">\n            <div v-html=\"goods.detail.content\"></div>\n        </div>\n\n        <div class=\"submit\" @click=\"showBottomPopup = !showBottomPopup\">立即购买</div>\n\n        <!--购买弹框-->\n        <van-popup v-model=\"showBottomPopup\"\n                   position=\"bottom\"\n                   class=\"trade\">\n            <div class=\"trade-box\">\n                <div class=\"trade-header\">\n                    <img class=\"trade-header-left\" src=\"https://yinghuo.binfenji.cn/uploads/11517354391_231972128.jpg\"\n                         alt=\"\">\n                    <div class=\"trade-header-right\">\n                        <div class=\"title line-clamp-two\">{{goods.detail.name}}</div>\n                        <div class=\"store\">库存 {{stockNum}}件</div>\n                        <div class=\"price\">\n                            ¥{{goodsPrice}}<b style=\"font-size: 14px;\">{{goodsPriceDecimal}}</b>\n                        </div>\n                    </div>\n                </div>\n                <div style=\"max-height: 232px; overflow-y: scroll;\" v-if=\"goods.detail.spec_type == 2\">\n                    <div class=\"trade-body\" v-for=\"(item, index) in goods.sku_data.spec_attr\" :key=\"item.group_id\">\n                        <div class=\"title\">{{item.group_name}}</div>\n                        <div class=\"body\">\n                            <span class=\"item\"\n                                  v-for=\"children in item.spec_items\"\n                                  :key=\"children.item_id\"\n                                  :class=\"children.active ? 'on' : ''\"\n                                  @click=\"handleSkuItem(children.item_id, index)\">{{children.spec_value}}</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"trade-number\">\n                    <div class=\"label\">数量</div>\n                    <div class=\"input\">\n                        <div class=\"box\">\n                            <span class=\"pull\" @click=\"handleEditGoodsNumber(0)\">-</span>\n                            <input type=\"number\" @input=\"handleSetGoodsNumber\" @focus=\"handleInputBlurBack\" v-model=\"goodsNumber\" placeholder=\"数量\"/>\n                            <span class=\"push\" @click=\"handleEditGoodsNumber(1)\">+</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"trade-footer\" @click=\"handleSubmit\">\n                    确认\n                </div>\n            </div>\n        </van-popup>\n    </div>\n</template>\n<style src=\"./index.css\" scoped></style>\n<script>\n    import {Toast, Popup} from 'vant';\n    import mixins from '../../../../common/mixin';\n    import navBar from '../../../../component/navBar';\n\n    import {swiper, swiperSlide} from 'vue-awesome-swiper';\n    import 'swiper/dist/css/swiper.css'\n\n    export default {\n        components: {\n            Toast,\n            navBar,\n            swiper,\n            swiperSlide,\n            Popup\n        },\n        mixins: [mixins],\n\n        data: () => ({\n            isLoadSuccess: false,               // 页面是否加载完成\n            showBottomPopup: false,             // 购买弹框\n            bannerHeight: 0,                    // banner高度\n            swiperOption: {                     // 轮播\n                autoplay: true,\n                speed: 1000,\n                pagination: {\n                    el: '.swiper-pagination'\n                }\n            },\n            goods: {},                           // 商品信息\n            goodsNumber: 1,                      // 购买商品数量\n            stockNum: 0,                         // 库存\n            goodsPrice: 0,                       // 商品价格\n            goodsPriceDecimal: 0,                // 商品价格后面小数\n            goodsSpecArr: [],                    // 记录规格数组\n            skuIndex: '',                        // 选中的sku\n        }),\n        // 设置路由钩子，存储页面来源\n        beforeRouteEnter(to, from, next) {\n            next(vm => {          //  这里的vm指的就是vue实例，可以用来当做this使用\n                sessionStorage.setItem('url_from', from.path);\n            })\n        },\n        created() {\n\n        },\n        mounted() {\n            this.handleSetBannerHeight();\n            this.handleLoad();\n        },\n        methods: {\n            // 可视窗口高度\n            handleSetBannerHeight: function () {\n                this.bannerHeight = document.body.clientWidth;\n            },\n            // 修改商品数量\n            handleEditGoodsNumber: function (index) {\n                if (index == 0) {\n                    if (this.goodsNumber > 1) {\n                        this.goodsNumber -= 1\n                    } else {\n                        this.goodsNumber = 1;\n                    }\n                } else {\n                    this.goodsNumber += 1\n                }\n            },\n            // 页面加载\n            handleLoad() {\n                this.request({\n                    url: 'api/store/goods',\n                    method: 'POST',\n                    data: {\n                        id: this.$route.query.id\n                    },\n                    success: (response) => {\n                        this.goods = response;\n                        console.log(this.goods.detail.min_price)\n                        // 初始化库存、商品显示价格\n                        if(this.goods.detail.min_price) {\n                            this.stockNum = this.goods.detail.sku[0].stock;\n                            this.goodsPriceDecimal = this.goods.detail.min_price.substring(this.goods.detail.min_price.length - 2);\n                            this.goodsPrice = this.goods.detail.min_price.substring(0, this.goods.detail.min_price.length - 2);\n                        }\n\n                        // 加载完成标识\n                        this.isLoadSuccess = true;\n\n                        // sku初始化\n                        if(this.goods.sku_data) {\n                            this.goods.sku_data.spec_attr.map((data) => {\n                                data.spec_items.map((children, index) => {\n                                    if (index == 0) {\n                                        children.active = true;\n                                    } else {\n                                        children.active = false;\n                                    }\n                                })\n                            })\n                        }\n\n                        // 判断是否是多规格\n                        if(this.goods.detail.spec_type == 2) {\n                            this.skuIndex = this.goods.sku_data.sku_list[0].id;\n                            this.handleUpdateSpecGoods(this.goods.sku_data)\n                        }\n                    },\n                    error: (response) => {\n\n                    },\n                    complete: () => {\n\n                    }\n                });\n            },\n            handleUpdateSpecGoods: function (data) {\n                for (let i in data.spec_attr) {\n                    for (let j in data.spec_attr[i].spec_items) {\n                        if (j < 1) {\n                            // 记录规格数组\n                            this.goodsSpecArr[i] = data.spec_attr[i].spec_items[0].item_id;\n                        }\n                    }\n                }\n                return data;\n            },\n            handleSkuItem: function (id, index) {\n                if(this.goods.detail.spec_type != 2) {\n                    return\n                }\n                this.goods.sku_data.spec_attr[index].spec_items.map((children, index) => {\n                    if (children.item_id === id) {\n                        children.active = true;\n                    } else {\n                        children.active = false;\n                    }\n                })\n\n                for (let i in this.goods.sku_data.spec_attr) {\n                    for (let j in this.goods.sku_data.spec_attr[i].spec_items) {\n                        if (index == i) {\n                            if (index == j) {\n                                this.goods.sku_data.spec_attr[i].spec_items.map((data) => {\n                                    if(data.active) {\n                                        this.goodsSpecArr[i] = data.item_id;\n                                    }\n                                })\n                            }\n                        }\n                    }\n                }\n                let spec_sku_id = this.goodsSpecArr.join('_');\n                let spec_list = this.goods.sku_data.sku_list,\n                skuItem = spec_list.find((val) => {\n                    return val.sku_index == spec_sku_id;\n                });\n                // 选中的规格\n                // console.log(spec_list)\n\n                this.skuIndex = skuItem.id;\n                this.stockNum = skuItem.form.stock;\n                this.goodsPriceDecimal = skuItem.form.price.substring(skuItem.form.price.length - 2);\n                this.goodsPrice = skuItem.form.price.substring(0, skuItem.form.price.length - 2);\n\n                this.$set(this.goods.sku_data.spec_attr, index, this.goods.sku_data.spec_attr[index]);\n            },\n            // 数量必须大于0\n            handleSetGoodsNumber: function() {\n                if(this.goodsNumber < 1) {\n                    this.goodsNumber = 1;\n                }\n            },\n            handleSubmit: function() {\n\n                let orderInfo = {\n                    id: parseInt(this.$route.query.id),\n                    sku_id: this.goods.detail.spec_type == 2 ? this.skuIndex : this.goods.detail.sku[0].id,\n                    in_delivery_rule: true,\n                    order_pay_price: this.goodsPrice + this.goodsPriceDecimal,\n                    order_total_price: Number(this.goodsPrice + this.goodsPriceDecimal) * this.goodsNumber,\n                    order_total_quantity: this.goodsNumber,\n                    goods_list: [{\n                        image: this.goods.detail.image[0] ? this.goods.detail.image[0].file.path : '',\n                        name: this.goods.detail.name\n                    }]\n                };\n\n                this.$router.push({\n                    path: '/plus/shopx/order/order',\n                    query: {\n                        order: JSON.stringify(orderInfo)\n                    }\n                });\n\n\n            }\n        }\n    }\n</script>\n"]}]}